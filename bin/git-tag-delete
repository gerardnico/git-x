#!/usr/bin/env bash

# @name Git Tag Delete
# @brief Delete a tag and release locally, remotely

# shellcheck source=../..//bash-lib/lib/bashlib-error.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-error.sh"
error::set_strict_mode
error::set_trap
# shellcheck source=../..//bash-lib/lib/bashlib-doc.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-doc.sh"
# shellcheck source=../..//bash-lib/lib/bashlib-git.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-git.sh"
# shellcheck source=../..//bash-lib/lib/bashlib-string.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-string.sh"
# shellcheck source=../..//bash-lib/lib/bashlib-path.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-path.sh"


function synopsis(){

  cat <<EOF
\`\`\`bash
$(basename "$0") tags
\`\`\`
tags is one or more tags separated by space
EOF

}

# Doc Synopsis
if [ "${1:-}" = "synopsis" ]; then
  synopsis
  exit 0
fi

# Help
if [[ "${1:-}" =~ -h|--help|help ]]; then
  doc::help synopsis
  exit 0
fi

tags=${1}
for tag in $tags; do
    echo "Deleting tag: $tag"
    echo "  * locally"
    git tag -d "$tag"
    echo "  * remotely"
    git push origin --delete "$tag"
done
# Delete GitHub release if gh CLI is available
if command -v gh &> /dev/null; then
    echo "Checking for GitHub release: $tag"
    if gh release view "$tag" &> /dev/null; then
        echo "Deleting GitHub release: $tag"
        gh release delete "$tag" --yes
    fi
fi
