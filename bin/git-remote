#!/usr/bin/env bash

set -Eeuo pipefail
# shellcheck source=../..//bash-lib/lib/bashlib-error.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-error.sh"
error::set_trap
# shellcheck source=../..//bash-lib/lib/bashlib-doc.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-doc.sh"
# shellcheck source=../..//bash-lib/lib/bashlib-git.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-git.sh"

function synopsis() {

  cat <<EOF
\`\`\`bash
$(basename "$0")
\`\`\`
EOF

}

# Doc Synopsis
if [ "${1:-}" = "synopsis" ]; then
  synopsis
  exit 0
fi

# Help
if [[ "${1:-}" =~ -h|--help|help ]]; then
  doc::help synopsis
  exit 0
fi

function git_remote_sync_status() {

  # Upstream
  git fetch
  upstreamCommitToMerge=$(git rev-list HEAD...'@{u}' --count)
  localCommitToPush=$(git::get_commits_not_pushed)
  echo ""
  echo "Commit sync:"
  echo "  * $upstreamCommitToMerge commits to merge"
  echo "  * $localCommitToPush commits to push"

}


function github_runner_status() {
  echo ""
  echo "GitHub Actions Run:"
  gh run list
}

function git_remote() {
  echo ""
  echo "Git Remote:"
  git remote -v
}

function main() {
  git_remote
  git_remote_sync_status
  github_runner_status
}

main
